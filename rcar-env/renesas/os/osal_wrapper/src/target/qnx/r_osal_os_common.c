/***********************************************************************************************************************
* Copyright [2022-2024] Renesas Electronics Corporation and/or its licensors. All Rights Reserved.
*
* The contents of this file (the "contents") are proprietary and confidential to Renesas Electronics Corporation
* and/or its licensors ("Renesas") and subject to statutory and contractual protections.
*
* Unless otherwise expressly agreed in writing between Renesas and you: 1) you may not use, copy, modify, distribute,
* display, or perform the contents; 2) you may not use any name or mark of Renesas for advertising or publicity
* purposes or in connection with your use of the contents; 3) RENESAS MAKES NO WARRANTY OR REPRESENTATIONS ABOUT THE
* SUITABILITY OF THE CONTENTS FOR ANY PURPOSE; THE CONTENTS ARE PROVIDED "AS IS" WITHOUT ANY EXPRESS OR IMPLIED
* WARRANTY, INCLUDING THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND
* NON-INFRINGEMENT; AND 4) RENESAS SHALL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL, OR CONSEQUENTIAL DAMAGES,
* INCLUDING DAMAGES RESULTING FROM LOSS OF USE, DATA, OR PROJECTS, WHETHER IN AN ACTION OF CONTRACT OR TORT, ARISING
* OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THE CONTENTS. Third-party contents included in this file may
* be subject to different terms.
***********************************************************************************************************************/
/***********************************************************************************************************************
* File Name :    r_osal_os_common.c 
* Version :      1.3.0
* Product Name : OSAL
* Device(s) :    R-Car
* Description :  Common OS IFs
***********************************************************************************************************************/

/***********************************************************************************************************************
 * includes
***********************************************************************************************************************/
#include <string.h>
#include <stdlib.h>
#include <pthread.h>
#include <sys/mman.h>
#include <unistd.h>

#include "target/qnx/r_osal_os_type.h"

/*******************************************************************************************************************//**
 * @ingroup OSAL_WRAPPER OSAL WRAPPER
 *
 * @{
 **********************************************************************************************************************/

/*======================================================================================================================
 Private macro definitions
======================================================================================================================*/
/***********************************************************************************************************************
 * @def OSAL_WRAPPER_VERSION_MAJOR
 * @brief Major version.
***********************************************************************************************************************/
#define OSAL_WRAPPER_VERSION_MAJOR   (2)

/***********************************************************************************************************************
 * @def OSAL_WRAPPER_VERSION_MINOR
 * @brief Minor version.
***********************************************************************************************************************/
#define OSAL_WRAPPER_VERSION_MINOR   (18)

/***********************************************************************************************************************
 * @def OSAL_WRAPPER_VERSION_PATCH
 * @brief Patch version.
***********************************************************************************************************************/
#define OSAL_WRAPPER_VERSION_PATCH   (0)

/*======================================================================================================================
 Public function definitions
======================================================================================================================*/
/***********************************************************************************************************************
 * XOS3_OSAL_QNX_CD_CD_COM_001
***********************************************************************************************************************/
/***********************************************************************************************************************
* Start of function R_OSAL_OS_BinarySearch()
***********************************************************************************************************************/
void* R_OSAL_OS_BinarySearch(const void* p_key,
                             const void* p_array,
                             size_t array_num,
                             size_t array_size,
                             p_osal_compare_func_t compare_function)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    void *p_ret_value;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if ((NULL == p_key) || (NULL == p_array) || (NULL == compare_function))
    {
        p_ret_value = NULL;
    }
    else
    {
        /* PRQA S 5135 1 # The compare function does not modify array and return consistent comparison results. */
        p_ret_value = bsearch(p_key, p_array, array_num, array_size, compare_function);
    }

    return p_ret_value;
}
/***********************************************************************************************************************
* End of function R_OSAL_OS_BinarySearch()
***********************************************************************************************************************/
/***********************************************************************************************************************
 * [Covers: XOS3_OSAL_QNX_UD_DD_COM_002]
***********************************************************************************************************************/

/***********************************************************************************************************************
 * XOS3_OSAL_QNX_CD_CD_COM_002
***********************************************************************************************************************/
/***********************************************************************************************************************
* Start of function R_OSAL_OS_Free()
***********************************************************************************************************************/
/* PRQA S 9106 1 # This function is intended to be used in common. */
void R_OSAL_OS_Free(void *p_ptr)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (NULL == p_ptr)
    {
        /* Do nothing */
    }
    else
    {
        /* PRQA S 5118 1 # Memory deallocation functions are available during deinitialization. */
        free(p_ptr);
    }

    return;
}
/***********************************************************************************************************************
* End of function R_OSAL_OS_Free()
***********************************************************************************************************************/
/***********************************************************************************************************************
 * [Covers: XOS3_OSAL_QNX_UD_DD_COM_003]
***********************************************************************************************************************/

/***********************************************************************************************************************
 * XOS3_OSAL_QNX_CD_CD_COM_003
***********************************************************************************************************************/
/***********************************************************************************************************************
* Start of function R_OSAL_OS_Malloc()
***********************************************************************************************************************/
/* PRQA S 9106 1 # This function is intended to be used in common. */
void* R_OSAL_OS_Malloc(size_t size)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    void *p_ret_value;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (0U == size)
    {
        p_ret_value = NULL;
    }
    else
    {
        /* PRQA S 5118 1 # Memory allocation functions are available during initialization. */
        p_ret_value = calloc(1, size);
    }

    return p_ret_value;
}
/***********************************************************************************************************************
* End of function R_OSAL_OS_Malloc()
***********************************************************************************************************************/
/***********************************************************************************************************************
 * [Covers: XOS3_OSAL_QNX_UD_DD_COM_004]
***********************************************************************************************************************/

/***********************************************************************************************************************
 * XOS3_OSAL_QNX_CD_CD_COM_006
***********************************************************************************************************************/
/***********************************************************************************************************************
* Start of function R_OSAL_OS_GetSysPageSize()
***********************************************************************************************************************/
/* PRQA S 5209 1 # The long type of return value is a specification and cannot be changed. */
long R_OSAL_OS_GetSysPageSize(void)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    return sysconf(_SC_PAGESIZE);
}
/***********************************************************************************************************************
* End of function R_OSAL_OS_GetSysPageSize()
***********************************************************************************************************************/
/***********************************************************************************************************************
 * [Covers: XOS3_OSAL_QNX_UD_DD_COM_008]
***********************************************************************************************************************/

/***********************************************************************************************************************
 * XOS3_OSAL_QNX_CD_CD_COM_008
***********************************************************************************************************************/
/***********************************************************************************************************************
* Start of function R_OSAL_OS_Strnlen()
***********************************************************************************************************************/
/* PRQA S 9106 1 # This function is intended to be used in common. */
size_t R_OSAL_OS_Strnlen(const char* p_str,
                         size_t maxlen)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    size_t ret_size;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (NULL == p_str)
    {
        ret_size = 0;
    }
    else
    {
        ret_size = strnlen(p_str, maxlen);
    }

    return ret_size;
}
/***********************************************************************************************************************
* End of function R_OSAL_OS_Strnlen()
***********************************************************************************************************************/
/***********************************************************************************************************************
 * [Covers: XOS3_OSAL_QNX_UD_DD_COM_010]
***********************************************************************************************************************/

/***********************************************************************************************************************
 * XOS3_OSAL_QNX_CD_CD_COM_009
***********************************************************************************************************************/
/***********************************************************************************************************************
* Start of function R_OSAL_OS_GetWrapperVersion()
***********************************************************************************************************************/
/* PRQA S 3408 1 # No prototype declaration is made to limit the calling destination of this function. */
const st_osal_sub_version_t *R_OSAL_OS_GetWrapperVersion(void)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    OSAL_STATIC const st_osal_sub_version_t s_wrapper_version =
    {
        .major = OSAL_WRAPPER_VERSION_MAJOR,
        .minor = OSAL_WRAPPER_VERSION_MINOR,
        .patch = OSAL_WRAPPER_VERSION_PATCH
    };

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/

    return &s_wrapper_version;
}
/***********************************************************************************************************************
* End of function R_OSAL_OS_GetWrapperVersion()
***********************************************************************************************************************/
/***********************************************************************************************************************
 * [Covers: XOS3_OSAL_QNX_UD_DD_COM_011]
***********************************************************************************************************************/

/***********************************************************************************************************************
 * XOS3_OSAL_QNX_CD_CD_COM_010
***********************************************************************************************************************/
/***********************************************************************************************************************
* Start of function R_OSAL_OS_IsISRContext()
***********************************************************************************************************************/
/* PRQA S 9106 1 # This function is intended to be used in common. */
e_osal_return_t R_OSAL_OS_IsISRContext(bool *const p_is_isr)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    e_osal_return_t osal_ret = OSAL_RETURN_OK;
    const void      *ret_value;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (NULL == p_is_isr)
    {
        osal_ret = OSAL_RETURN_FAIL;
    }
    else
    {
        ret_value = pthread_getspecific(g_context_key);
        if (NULL == ret_value)
        {
            *p_is_isr = false;
        }
        else
        {
            *p_is_isr = true;
        }
    }

    return osal_ret;
}
/***********************************************************************************************************************
* End of function R_OSAL_OS_IsISRContext()
***********************************************************************************************************************/
/***********************************************************************************************************************
 * [Covers: XOS3_OSAL_QNX_UD_DD_COM_012]
***********************************************************************************************************************/

/** @} OSAL_WRAPPER */

/*======================================================================================================================
End of File
======================================================================================================================*/

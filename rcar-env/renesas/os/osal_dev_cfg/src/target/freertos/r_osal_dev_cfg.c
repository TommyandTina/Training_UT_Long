/*************************************************************************************************************
* OSAL Device Configurator
* Copyright (c) [2020-2022] Renesas Electronics Corporation
* This software is released under the MIT License.
* http://opensource.org/licenses/mit-license.php
*************************************************************************************************************/
/***********************************************************************************************************************
* File Name :    r_osal_dev_cfg.c
* Version :      1.0.0
* Product Name : OSAL
* Device(s) :    R-Car
* Description :  OSAL device configuration interface
***********************************************************************************************************************/

/*******************************************************************************************************************//**
 * includes
***********************************************************************************************************************/
#include "rcar-xos/osal/r_osal.h"
#include "config/r_osal_dev_cfg.h"

/*******************************************************************************************************************//**
 * @var SharedBase
 * The base address of the shared area to be defined by a upper layer software.
***********************************************************************************************************************/
extern const void * SharedBase;

/*******************************************************************************************************************//**
 * @var SharedLimit
 * The bottom address of the shared area to be defined by a upper layer software.
***********************************************************************************************************************/
extern const void * SharedLimit;

/***********************************************************************************************************************
* Start of function R_OSAL_DCFG_GetNumOfDevice()
***********************************************************************************************************************/
size_t R_OSAL_DCFG_GetNumOfDevice(void)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    static size_t num = 0;
    size_t count      = 0;
    bool   last_data = false;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (0 == num)
    {
        for (count = 0;
            ((sizeof(gs_osal_device_control) / sizeof(st_osal_device_control_t) > count) && (false == last_data));
            count++)
        {
            if (OSAL_DEVICE_INVALID_ID == gs_osal_device_info[count].id)
            {
                last_data = true;
                num = count;
            }
            else
            {
                /* Do nothing */
            }
        }
    }
    else
    {
        /* Do nothing */
    }

    return num;
}

/***********************************************************************************************************************
* End of function R_OSAL_DCFG_GetNumOfDevice()
***********************************************************************************************************************/

/***********************************************************************************************************************
* Start of function R_OSAL_DCFG_GetDeviceInfo()
***********************************************************************************************************************/
e_osal_return_t R_OSAL_DCFG_GetDeviceInfo(uint32_t num,
                                          st_osal_device_control_t **pp_info)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    e_osal_return_t osal_ret = OSAL_RETURN_OK;
    bool   last_data         = false;
    size_t count             = 0;
    static size_t num_of_config = 0;
    size_t num_of_control    = 0;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (NULL == pp_info)
    {
        osal_ret = OSAL_RETURN_PAR;
    }
    else
    {
        num_of_control = sizeof(gs_osal_device_control) / sizeof(st_osal_device_control_t);

        if (0 == num_of_config)
        {
            for (count = 0;
                 (num_of_control > count) && (false == last_data);
                 count++)
            {
                if (OSAL_DEVICE_INVALID_ID == gs_osal_device_info[count].id)
                {
                    last_data = true;
                    num_of_config = count;
                }
                else
                {
                    /* Do nothing */
                }
            }
        }
        else
        {
            /* Do nothing */
        }

        if ((num < num_of_config) && (num < num_of_control))
        {
            gs_osal_device_control[num].dev_info = &gs_osal_device_info[num];
            gs_osal_device_control[num].inner_timeout = OSAL_DCFG_INNER_TIMEOUT;
            *pp_info = &gs_osal_device_control[num];
        }
        else
        {
            osal_ret = OSAL_RETURN_PAR;
        }
    }

    return osal_ret;
}
/***********************************************************************************************************************
* End of function R_OSAL_DCFG_GetDeviceInfo()
***********************************************************************************************************************/

/***********************************************************************************************************************
* Start of function R_OSAL_DCFG_GetPMAConfiguration()
***********************************************************************************************************************/
e_osal_return_t R_OSAL_DCFG_GetPMAConfiguration(st_pma_config_t * const p_config)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    e_osal_return_t osal_ret = OSAL_RETURN_OK;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (NULL == p_config)
    {
        osal_ret = OSAL_RETURN_PAR;
    }
    else
    {
        p_config->task_priority           = (uint32_t)OSAL_PMA_PRIORITY;
        p_config->timeout_ms              = OSAL_PMA_TIMEOUT;
        p_config->polling_max_num         = OSAL_PMA_POLLING_MAX_NUM;
        p_config->loop_num_for_rclk_cycle = OSAL_PMA_LOOP_NUM_FOR_RCLK_CYCLE;
    }

    return osal_ret;
}
/***********************************************************************************************************************
* End of function R_OSAL_DCFG_GetPMAConfiguration()
***********************************************************************************************************************/

/***********************************************************************************************************************
* Start of function R_OSAL_DCFG_GetAxiBusInfo()
***********************************************************************************************************************/
e_osal_return_t R_OSAL_DCFG_GetAxiBusInfo(st_osal_axi_bus_control_t **pp_info)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    e_osal_return_t osal_ret = OSAL_RETURN_OK;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (NULL == pp_info)
    {
        osal_ret = OSAL_RETURN_PAR;
    }
    else
    {
        *pp_info = &gs_osal_axi_bus_control;
    }

    return osal_ret;
}
/***********************************************************************************************************************
* End of function R_OSAL_DCFG_GetAxiBusInfo()
***********************************************************************************************************************/

/***********************************************************************************************************************
* Start of function R_OSAL_DCFG_GetMaxConfigOfMemory()
***********************************************************************************************************************/
e_osal_return_t R_OSAL_DCFG_GetMaxConfigOfMemory(st_osal_mmngr_config_t **pp_config)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/
    e_osal_return_t osal_ret = OSAL_RETURN_OK;

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/
    if (NULL == pp_config)
    {
        osal_ret = OSAL_RETURN_PAR;
    }
    else
    {
        gs_osal_memory_max_configration.memory_limit = ((size_t)(&SharedLimit) - (size_t)(&SharedBase) - OSAL_MMNGR_MEM_RESERVE_SIZE);
        *pp_config = &gs_osal_memory_max_configration;
    }

    return osal_ret;
}
/***********************************************************************************************************************
* End of function R_OSAL_DCFG_GetMaxConfigOfMemory()
***********************************************************************************************************************/

/***********************************************************************************************************************
* Start of function R_OSAL_DCFG_GetSocType()
***********************************************************************************************************************/
uint64_t R_OSAL_DCFG_GetSocType(void)
{
    /*------------------------------------------------------------------------------------------------------------------
    Local variables
    ------------------------------------------------------------------------------------------------------------------*/

    /*------------------------------------------------------------------------------------------------------------------
    Function body
    ------------------------------------------------------------------------------------------------------------------*/

    return g_osal_device_soc_type.device_soc_type;
}

/***********************************************************************************************************************
* End of function R_OSAL_DCFG_GetSocType()
***********************************************************************************************************************/

